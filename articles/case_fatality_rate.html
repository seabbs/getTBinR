<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring Estimates of the Tuberculosis Case Fatality Ratio â€¢ getTBinR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Exploring Estimates of the Tuberculosis Case Fatality Ratio">
<meta property="og:description" content="getTBinR">
<meta property="og:image" content="samabbott.co.uk/getTBinR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">getTBinR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/intro.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Case Studies
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case_study_global_trends.html">Exploring Global Trends in Tuberculosis Incidence Rates</a>
    </li>
    <li>
      <a href="../articles/case_fatality_rate.html">Exploring Estimates of the Tuberculosis Case Fatality Ratio</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dashboards
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.seabbs.co.uk/shiny/ExploreGlobalTB/">Explore Global Tuberculosis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://www.samabbott.co.uk/tags/who/">Blog posts</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/seabbs/getTBinR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring Estimates of the Tuberculosis Case Fatality Ratio</h1>
                        <h4 class="author">Sam Abbott</h4>
            
            <h4 class="date">2020-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/seabbs/getTBinR/blob/master/vignettes/case_fatality_rate.Rmd"><code>vignettes/case_fatality_rate.Rmd</code></a></small>
      <div class="hidden name"><code>case_fatality_rate.Rmd</code></div>

    </div>

    
    
<p>This case study investigates World Health Organization (WHO) estimates of the case fatality ratio for Tuberculosis (TB). It then estimates case fatality rates using a simple approximation and compares the results to the WHO estimates. It was adapted from <a href="https://www.samabbott.co.uk/post/est-cfr-gettbinr/">this</a> blog post.</p>
<p>It is estimated that in 2016 there was more than 10 million cases of active TB, with 1.3 million deaths (<a href="https://en.wikipedia.org/wiki/Tuberculosis">source</a>). This makes TB the leading cause of death from an infectious disease. Despite the high numbers of cases globally, and high levels of mortality, TB is often considered a historic disease in developed countries. However, in recent years previously declining trends have flattened out and there is increasing concern surrounding multi-drug resistant TB, which has a greatly reduced the rate of successful treatment (<a href="http://www.who.int/mediacentre/factsheets/fs104/en/">source</a>).</p>
<p>A key component of TB control is reducing the case fatality rate from active TB, this post explores WHO estimates for the TB case fatality rate in the most recent year of data and then estimates the case fatality rates in previous years. The first step is to download and install the required packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">getTBinR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scales</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)</pre></body></html></div>
<p>Now we use <code>getTBinR</code> to download the TB burden data and its accompanying data dictionary.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">tb_burden</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_tb_burden.html">get_tb_burden</a></span>()
<span class="no">dict</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_data_dict.html">get_data_dict</a></span>()

<span class="no">tb_burden</span>
<span class="co">#&gt; # A tibble: 4,031 x 71</span>
<span class="co">#&gt;    country iso2  iso3  iso_numeric g_whoregion  year e_pop_num e_inc_100k</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2000  20779953        190</span>
<span class="co">#&gt;  2 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2001  21606988        189</span>
<span class="co">#&gt;  3 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2002  22600770        189</span>
<span class="co">#&gt;  4 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2003  23680871        189</span>
<span class="co">#&gt;  5 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2004  24726684        189</span>
<span class="co">#&gt;  6 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2005  25654277        189</span>
<span class="co">#&gt;  7 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2006  26433049        189</span>
<span class="co">#&gt;  8 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2007  27100536        189</span>
<span class="co">#&gt;  9 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2008  27722276        189</span>
<span class="co">#&gt; 10 Afghanâ€¦ AF    AFG             4 Eastern Meâ€¦  2009  28394813        189</span>
<span class="co">#&gt; # â€¦ with 4,021 more rows, and 63 more variables: e_inc_100k_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_inc_100k_hi &lt;dbl&gt;, e_inc_num &lt;int&gt;, e_inc_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_hi &lt;int&gt;, e_tbhiv_prct &lt;dbl&gt;, e_tbhiv_prct_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_tbhiv_prct_hi &lt;dbl&gt;, e_inc_tbhiv_100k &lt;dbl&gt;, e_inc_tbhiv_100k_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_inc_tbhiv_100k_hi &lt;dbl&gt;, e_inc_tbhiv_num &lt;int&gt;, e_inc_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_tbhiv_num_hi &lt;int&gt;, e_mort_exc_tbhiv_100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_100k_lo &lt;dbl&gt;, e_mort_exc_tbhiv_100k_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_num &lt;int&gt;, e_mort_exc_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_num_hi &lt;int&gt;, e_mort_tbhiv_100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_100k_lo &lt;dbl&gt;, e_mort_tbhiv_100k_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_num &lt;int&gt;, e_mort_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_num_hi &lt;int&gt;, e_mort_100k &lt;dbl&gt;, e_mort_100k_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_100k_hi &lt;dbl&gt;, e_mort_num &lt;int&gt;, e_mort_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_num_hi &lt;int&gt;, cfr &lt;dbl&gt;, cfr_lo &lt;dbl&gt;, cfr_hi &lt;dbl&gt;, cfr_pct &lt;int&gt;,</span>
<span class="co">#&gt; #   cfr_pct_lo &lt;int&gt;, cfr_pct_hi &lt;int&gt;, c_newinc_100k &lt;dbl&gt;, c_cdr &lt;dbl&gt;,</span>
<span class="co">#&gt; #   c_cdr_lo &lt;dbl&gt;, c_cdr_hi &lt;dbl&gt;, source_rr_new &lt;chr&gt;,</span>
<span class="co">#&gt; #   source_drs_coverage_new &lt;chr&gt;, source_drs_year_new &lt;int&gt;,</span>
<span class="co">#&gt; #   e_rr_pct_new &lt;dbl&gt;, e_rr_pct_new_lo &lt;dbl&gt;, e_rr_pct_new_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mdr_pct_rr_new &lt;int&gt;, source_rr_ret &lt;chr&gt;, source_drs_coverage_ret &lt;chr&gt;,</span>
<span class="co">#&gt; #   source_drs_year_ret &lt;int&gt;, e_rr_pct_ret &lt;dbl&gt;, e_rr_pct_ret_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_rr_pct_ret_hi &lt;dbl&gt;, e_mdr_pct_rr_ret &lt;int&gt;, e_inc_rr_num &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_rr_num_lo &lt;int&gt;, e_inc_rr_num_hi &lt;int&gt;, e_mdr_pct_rr &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_rr_in_notified_labconf_pulm &lt;int&gt;,</span>
<span class="co">#&gt; #   e_rr_in_notified_labconf_pulm_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_rr_in_notified_labconf_pulm_hi &lt;int&gt;</span>

<span class="no">dict</span>
<span class="co">#&gt; # A tibble: 495 x 4</span>
<span class="co">#&gt;    variable_name   dataset code_list definition                                 </span>
<span class="co">#&gt;    &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;                                      </span>
<span class="co">#&gt;  1 budget_cpp_dstb Budget  ""        Average cost of drugs budgeted per patientâ€¦</span>
<span class="co">#&gt;  2 budget_cpp_mdr  Budget  ""        Average cost of drugs budgeted per patientâ€¦</span>
<span class="co">#&gt;  3 budget_cpp_xdr  Budget  ""        Average cost of drugs budgeted per patientâ€¦</span>
<span class="co">#&gt;  4 budget_fld      Budget  ""        Budget required for drugs to treat drug-suâ€¦</span>
<span class="co">#&gt;  5 budget_lab      Budget  ""        Budget required for laboratory infrastructâ€¦</span>
<span class="co">#&gt;  6 budget_mdrmgt   Budget  ""        Budget required for programme costs to treâ€¦</span>
<span class="co">#&gt;  7 budget_orsrvy   Budget  ""        Budget required for operational research aâ€¦</span>
<span class="co">#&gt;  8 budget_oth      Budget  ""        Budget required for all other budget line â€¦</span>
<span class="co">#&gt;  9 budget_patsup   Budget  ""        Budget required for patient support (US Doâ€¦</span>
<span class="co">#&gt; 10 budget_prog     Budget  ""        Budget required for programme costs to treâ€¦</span>
<span class="co">#&gt; # â€¦ with 485 more rows</span></pre></body></html></div>
<p>We want to explore the case fatality rate (<code>cfr</code>), lets first look at the WHO definition.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/search_data_dict.html">search_data_dict</a></span>(<span class="st">"cfr"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left">variable_name</th>
<th align="left">dataset</th>
<th align="left">code_list</th>
<th align="left">definition</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">cfr</td>
<td align="left">Estimates</td>
<td align="left"></td>
<td align="left">Estimated TB case fatality ratio</td>
</tr></tbody>
</table>
<p>Maps can be a useful first visualisation for summarising spatial data, although they can also be misleading for more complex comparisons. Lets look at global TB incidence rates (per 100,000 population) in the most recent year of data (when written 2016), and the WHO estimate of the case fatality ratio in the same year.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Map TB incidence rates</span>
<span class="no">mp1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_tb_burden.html">map_tb_burden</a></span>(
                     <span class="kw">viridis_palette</span> <span class="kw">=</span> <span class="st">"cividis"</span>,
                     <span class="kw">viridis_direction</span> <span class="kw">=</span> -<span class="fl">1</span>
                     ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Map of Tuberculosis Incidence Rates"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Incidence rates are per 100,000 population"</span>)

<span class="no">mp1</span></pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/make-inc-map-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Map TB case fatality ratio -2016</span>
<span class="no">mp2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/map_tb_burden.html">map_tb_burden</a></span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"cfr"</span>,
                     <span class="kw">viridis_palette</span> <span class="kw">=</span> <span class="st">"cividis"</span>,
                     <span class="kw">viridis_direction</span> <span class="kw">=</span> -<span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Map of Tuberculosis Case Fatality Ratio"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Case fatality rate estimated by the WHO"</span>)

<span class="no">mp2</span></pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/make-cfr-map-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Whilst quantitative insights are hard to glean from the above maps we can see that incidence rates appear to be highest in Africa and Asia (interpretation based on data from 2016). It also looks like the case fatality ratios are highest in these regions as well.</p>
<p>The WHO have only provided estimates for the case fatality ratio from the most recent year of data, estimating the case fatality ratio for other years will allow trends over time to be explored. We do this by first summarising TB incidence rates, and mortality rates by region. This allows insights into the general global picture to be more easily extracted (<strong>Note: This functionality has now been implemented into the <code>getTBinR</code> using <code><a href="../reference/plot_tb_burden_summary.html">getTBinR::plot_tb_burden_summary(metric_label = "e_inc_100k", legend = "none", facet = "Area", scales = "free_y", compare_to_world = FALSE)</a></code> - can be customised to plot all metrics see <code><a href="../reference/plot_tb_burden_summary.html">?getTBinR::plot_tb_burden_summary</a></code> for details</strong>). The first step is to write a function to summarise rates on regional levels, we do this using <code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">dplyr::summarise_at</a></code>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## Make function to summarise rates in a given region</span>
<span class="no">rate_region</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">metric</span> <span class="kw">=</span> <span class="kw">NULL</span>) {

  <span class="no">metric_vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">metric</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">metric</span>, <span class="st">"_lo"</span>), <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">metric</span>, <span class="st">"_hi"</span>))

  <span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">df</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">year</span>, <span class="no">g_whoregion</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_at</a></span>(<span class="kw">.vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">metric_vars</span>, <span class="st">"e_pop_num"</span>),
                 <span class="kw">.funs</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">.</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>))) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw">.vars</span> <span class="kw">=</span> <span class="no">metric_vars</span>,
              <span class="kw">.funs</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="no">.</span> / <span class="no">e_pop_num</span> * <span class="fl">1e5</span>))
}</pre></body></html></div>
<p>We then write a reusable plotting function to visualise this data (making use of <code>aes_string</code>).</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## Plotting function for rates</span>
<span class="no">plot_rate_region</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">metric</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">title</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">subtitle</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                             <span class="no">y_lab</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">scales</span> <span class="kw">=</span> <span class="kw">NULL</span>) {

  <span class="no">metric_vars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">metric</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">metric</span>, <span class="st">"_lo"</span>), <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">metric</span>, <span class="st">"_hi"</span>))

  <span class="no">df</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"year"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">metric</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"g_whoregion"</span>,
                      <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"g_whoregion"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.3</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">metric_vars</span>[<span class="fl">2</span>], <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">metric_vars</span>[<span class="fl">3</span>]), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.1</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">labels</span> <span class="kw">=</span> <span class="no">comma</span>) +
    <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_colour_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">option</span> <span class="kw">=</span> <span class="st">"E"</span>) +
    <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">discrete</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">option</span> <span class="kw">=</span> <span class="st">"E"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">title</span>, <span class="kw">subtitle</span> <span class="kw">=</span> <span class="no">subtitle</span>,
         <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Year"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y_lab</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">g_whoregion</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="no">scales</span>)
}</pre></body></html></div>
<p>We can now quickly plot TB incidence rates by region, as well as mortality rates by region.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">plot_inc_region</span> <span class="kw">&lt;-</span> <span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
  <span class="fu">rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_inc_num"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">plot_rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_inc_num"</span>,
                   <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Tuberculosis Incidence Rates"</span>,
                   <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"By region and year"</span>,
                   <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>,
                   <span class="kw">y_lab</span> <span class="kw">=</span> <span class="st">"Tuberculosis Incidence Rates (per 100,000 population)"</span>)
<span class="co">#&gt; Warning: `funs()` is deprecated as of dplyr 0.8.0.</span>
<span class="co">#&gt; Please use a list of either functions or lambdas: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Simple named list: </span>
<span class="co">#&gt;   list(mean = mean, median = median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Auto named with `tibble::lst()`: </span>
<span class="co">#&gt;   tibble::lst(mean, median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Using lambdas</span>
<span class="co">#&gt;   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span>

<span class="no">plot_inc_region</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Source: World Health Organization"</span>)</pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/plot-tb-inc-reg-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">plot_mort_region</span> <span class="kw">&lt;-</span> <span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
  <span class="fu">rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_mort_num"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">plot_rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_mort_num"</span>,
                   <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Tuberculosis Mortality Rates"</span>,
                   <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"By region and year"</span>,
                   <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>,
                   <span class="kw">y_lab</span> <span class="kw">=</span> <span class="st">"Tuberculosis Mortality Rates (per 100,000 population)"</span>)

<span class="no">plot_mort_region</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Source: World Health Organization"</span>)</pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/plot-tb-mort-reg-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This gives an encouraging picture with both incidence rates and mortality rates declining in all regions (as of 2016). As we observed from the maps above incidence rates (and mortality rates) are highest in Africa, and South-East Asia. We also see that the rate of decline in incidence rates varies across regions, with South-East Asia and the Eastern Mediterranean experiencing the slowest decreases. Interestingly it also appears that mortality rates in some areas are decreasing more quickly than incidence rates, this is most notable for Europe. As mortality rates and incidence rates are highly correlated to explore in more depth we need to estimate the case fatality ratio for all years in the data.</p>
<p>To validate our estimates we first extract the regional estimates for the case fatality ratio based on the WHO estimates, by taking the mean (and standard deviation) of case fatality ratios by country in each region. This gives an estimate for case fatality rates at the regional level as well as the between country variation.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## Summarise Case fatality rate by region - only availble for most recent year</span>
<span class="no">region_case_fat</span> <span class="kw">&lt;-</span> <span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">year</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">year</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">year</span>, <span class="no">g_whoregion</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">cfr</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
            <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">cfr</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">ll</span> <span class="kw">=</span> <span class="no">mean</span> - <span class="no">sd</span>,
         <span class="kw">lll</span> <span class="kw">=</span> <span class="no">mean</span> - <span class="fl">2</span> * <span class="no">sd</span>,
         <span class="kw">hh</span> <span class="kw">=</span> <span class="no">mean</span> + <span class="no">sd</span>,
         <span class="kw">hhh</span> <span class="kw">=</span> <span class="no">mean</span> + <span class="fl">2</span> * <span class="no">sd</span>)
<span class="co">#&gt; `summarise()` regrouping output by 'year' (override with `.groups` argument)</span>

<span class="no">region_case_fat</span>
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt; # Groups:   year [1]</span>
<span class="co">#&gt;    year g_whoregion             mean     sd      ll       lll    hh   hhh</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2018 Africa                0.228  0.0817  0.147   0.0648   0.310 0.392</span>
<span class="co">#&gt; 2  2018 Americas              0.163  0.177  -0.0140 -0.191    0.340 0.516</span>
<span class="co">#&gt; 3  2018 Eastern Mediterranean 0.122  0.139  -0.0169 -0.156    0.261 0.401</span>
<span class="co">#&gt; 4  2018 Europe                0.0819 0.0473  0.0346 -0.0127   0.129 0.177</span>
<span class="co">#&gt; 5  2018 South-East Asia       0.121  0.0541  0.0668  0.0127   0.175 0.229</span>
<span class="co">#&gt; 6  2018 Western Pacific       0.0842 0.0421  0.0422  0.000125 0.126 0.168</span></pre></body></html></div>
<p>We then estimate the regional case fatality ratio by taking the regional mortality rate and dividing it by the regional incidence rate for each year (<strong>Note: Again this is now possible using <code>plot_tb_burden_summary</code> - by changing the <code>metric</code> and <code>denom</code> arguments</strong>). We also do this for the high and low mortality rate estimates (using the lowest estimate for TB mortality and the highest estimate for incidence rates to get the lower bound, and vice versa for the high bound). This gives,</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">region_case_fatality</span> <span class="kw">&lt;-</span> <span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
  <span class="fu">rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_inc_num"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
              <span class="fu">rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"e_mort_num"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">case_fat_rate</span> <span class="kw">=</span> <span class="no">e_mort_num</span> / <span class="no">e_inc_num</span>,
         <span class="kw">case_fat_rate_lo</span> <span class="kw">=</span> <span class="no">e_mort_num_lo</span> / <span class="no">e_inc_num_hi</span>,
         <span class="kw">case_fat_rate_hi</span> <span class="kw">=</span> <span class="no">e_mort_num_hi</span> / <span class="no">e_inc_num_lo</span>)
<span class="co">#&gt; Joining, by = c("year", "g_whoregion", "e_pop_num")</span>

<span class="no">region_case_fatality</span>
<span class="co">#&gt; # A tibble: 114 x 12</span>
<span class="co">#&gt;     year g_whoregion e_inc_num e_inc_num_lo e_inc_num_hi e_pop_num e_mort_num</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2000 Africa          329.         209.         477.     6.54e8     129.  </span>
<span class="co">#&gt;  2  2000 Americas         36.2         28.5         44.5    8.33e8       4.69</span>
<span class="co">#&gt;  3  2000 Eastern Meâ€¦     128.          88.4        176.     4.50e8      19.4 </span>
<span class="co">#&gt;  4  2000 Europe           51.7         37.5         68.5    8.56e8       8.87</span>
<span class="co">#&gt;  5  2000 South-Eastâ€¦     299.         183.         449.     1.57e9      67.2 </span>
<span class="co">#&gt;  6  2000 Western Paâ€¦     135.          92.5        186.     1.71e9      13.4 </span>
<span class="co">#&gt;  7  2001 Africa          335.         213.         482.     6.71e8     129.  </span>
<span class="co">#&gt;  8  2001 Americas         34.3         27.3         42.4    8.43e8       4.50</span>
<span class="co">#&gt;  9  2001 Eastern Meâ€¦     128.          88.0        176.     4.60e8      18.9 </span>
<span class="co">#&gt; 10  2001 Europe           51.2         37.1         67.5    8.58e8       8.66</span>
<span class="co">#&gt; # â€¦ with 104 more rows, and 5 more variables: e_mort_num_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_num_hi &lt;dbl&gt;, case_fat_rate &lt;dbl&gt;, case_fat_rate_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   case_fat_rate_hi &lt;dbl&gt;</span></pre></body></html></div>
<p>We can then plot this using the <code>plot_rate_region</code> function outlined above, combined with addition layers to compare our estimate to that produced by the WHO.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">plot_region_case_fatality</span> <span class="kw">&lt;-</span> <span class="no">region_case_fatality</span> <span class="kw">%&gt;%</span>
  <span class="fu">plot_rate_region</span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"case_fat_rate"</span>,
                   <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Tuberculosis Case Fatality Rate"</span>,
                   <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"By WHO region abd year"</span>,
                   <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>,
                   <span class="kw">y_lab</span> <span class="kw">=</span> <span class="st">"Estimated TB Case Fatality Ratio"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Case fatality ratio estimated by taking the ratio of TB mortality rates and TB incidence rates each year in all years. For the most recent year 
       the mean regional case fatality ratio estimated by the WHO is also shown (along with one and two standard deviations)"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">region_case_fat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">mean</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">year</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">g_whoregion</span>),
             <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.3</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">region_case_fat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ll</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">hh</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>),
                 <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">region_case_fat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lll</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">hhh</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>),
                 <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"black"</span>)

<span class="no">plot_region_case_fatality</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Source: World Health Organization"</span>)</pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/plot-regional-cfr-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We see that the estimate using mortality rates / incidence rates compares well to the estimate published for the most recent year by the WHO, although there is substantial within country variation. For all regions our estimate has substantial uncertainty. The plot suggests that the TB case fatality ratio is decreasing over time in all regions (as of 2016), although this reduction appears to be very minimal in some regions (such as the Americas, Africa, and the Eastern Mediterranean). It is likely that this trend does not hold across all countries, but this is beyond the scope of this post (watch this space).</p>
<p>As a first look at the case fatality ratios in individual countries we can quickly pull out the 10 countries with the highest case fatality ratio in the most recent year of data. These are,</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">highest_case_fataltity_countries</span> <span class="kw">&lt;-</span> <span class="no">tb_burden</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">year</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">year</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(<span class="no">cfr</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">1</span>:<span class="fl">10</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">country</span>)

<span class="no">highest_case_fataltity_countries</span>
<span class="co">#&gt;  [1] "Saint Lucia"          "Grenada"              "United Arab Emirates"</span>
<span class="co">#&gt;  [4] "Dominica"             "Anguilla"             "Puerto Rico"         </span>
<span class="co">#&gt;  [7] "Guinea-Bissau"        "Ghana"                "Nigeria"             </span>
<span class="co">#&gt; [10] "Malawi"</span></pre></body></html></div>
<p>We can then plot the TB case fatality ratio in these countries, as well as the TB incidence rates over time.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co">## Plot overview of cases fatality ratios</span>
<span class="no">plot_high_cfr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_tb_burden_overview.html">plot_tb_burden_overview</a></span>(<span class="kw">metric</span> <span class="kw">=</span> <span class="st">"cfr"</span>,
                                         <span class="kw">countries</span> <span class="kw">=</span> <span class="no">highest_case_fataltity_countries</span>,
                                         <span class="kw">viridis_palette</span> <span class="kw">=</span> <span class="st">"cividis"</span>,
                                         <span class="kw">viridis_direction</span> <span class="kw">=</span> -<span class="fl">1</span>,
                                         <span class="kw">viridis_end</span> <span class="kw">=</span> <span class="fl">0.9</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Tuberculosis Case Fatality Ratio - 2016"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"For the countries with the 10 highest ratios"</span>)

<span class="no">plot_high_cfr</span></pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/plot-highest-cfr-countries-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">plot_inc_high_cfr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_tb_burden_overview.html">plot_tb_burden_overview</a></span>(<span class="kw">countries</span> <span class="kw">=</span> <span class="no">highest_case_fataltity_countries</span>,
                                             <span class="kw">viridis_palette</span> <span class="kw">=</span> <span class="st">"cividis"</span>,
                                             <span class="kw">viridis_direction</span> <span class="kw">=</span> -<span class="fl">1</span>,
                                             <span class="kw">viridis_end</span> <span class="kw">=</span> <span class="fl">0.9</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"right"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Tuberculosis Incidence Rate"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"In the countries with the 10 highest TB case fatality ratios"</span>)

<span class="no">plot_inc_high_cfr</span></pre></body></html></div>
<p><img src="case_fatality_rate_files/figure-html/plot-inc-rates-high-cfr-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We see that for some countries on this list (i.e Anguilla, the United Arab Emirates, and Dominica) the high case fatality ratio estimates are likely to be based on a very low sample size and therefore may not be trustworthy. Worryingly however for several countries (Lesotho, Tanzania, Guinea-Bissau, and Ghana, and Nigeria) with extremely high case fatality ratios incidence rates are also very high, which will correspond to very high mortality rates. These countries are all in Africa, which as a region also had the highest incidence rates and the highest case fatality ratio. It is clear from these plots that Africa, and these countries in particular should be a particular focus of TB control efforts if TB mortality rates are to be reduced more quickly.</p>
<p>The WHO TB data contains many more variables not mentioned in this post and getTBinR contains additional features, see the <a href="https://www.samabbott.co.uk/getTBinR/">site for getTBinR</a> for details. See <a href="https://gist.github.com/seabbs">my gists</a> for code snippets to get you started in exploring the data further. Package feature requests are welcome, preferably by filing a <a href="https://github.com/seabbs/getTBinR/issues">GitHub issue</a>, as are suggestions for additional data sources to include.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sam Abbott.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '6c737a6c632ea7eab75c912a6b07b5f1',
    indexName: 'gettbinr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
